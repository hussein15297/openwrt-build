name: Build OpenWRT for Linksys WAP 300N

on:
  push:
    branches:
      - main
  pull_request:
    branches:
      - main

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Set up OpenWRT Build System
        run: |
          sudo apt update
          sudo apt install -y build-essential ccache git libncurses5-dev zlib1g-dev gawk flex gettext wget unzip python3-pip
          sudo apt-get install -y python3-setuptools
      # تثبيت Python 3
      - name: Install Python 3
        run: |
          sudo apt-get install -y python3 python3-pip
          python3 --version  # للتحقق من النسخة

      - name: Download OpenWRT source code
        run: |
          git clone https://github.com/openwrt/openwrt.git
          cd openwrt
          ./scripts/feeds update -a
          ./scripts/feeds install -a

      - name: Configure OpenWRT for Linksys WAP 300N
        run: |
          cd openwrt
          # إعدادات مباشرة دون واجهة
          
          cp ..configs/linksys_wap_300n_defconfig ./.config
          # تأكد من أن التكوين مناسب لجهازك

      - name: Configure Country Code and Channels for 2.4GHz SuperChannel
        run: |
          cd openwrt
          for channel in 2312 2317 2322 2327 2332 2337 2342 2347 2352 2357 2362 2367 2372 2377 2382 2387 2392 2397 2402 2407 2412 2417 2422 2427 2432 2437 2442 2447 2452 2457 2462 2467 2472 2477 2482 2487 2492 2497 2502 2507 2512 2517 2522 2527 2532 2537 2542 2547 2552 2557 2562 2567 2572 2577 2582 2587 2592 2597 2602 2607 2612 2617 2622 2627 2632 2637 2642 2647 2652 2657 2662 2667 2672 2677 2682 2687 2692 2697 2702 2707 2712 2717 2722 2727 2732
          do
            echo "
            config wifi-device radio0
              option type \"mac80211\"
              option hwmode \"11g\"
              option country \"seinsoft\"
              option channel \"$channel\"
              option txpower \"30\"
              option htmode \"HT20\"
              option noscan \"1\"" >> ./package/kernel/mac80211/files/etc/config/wireless
          done

      - name: Configure Country Code and Channels for 5GHz SuperChannel
        run: |
          cd openwrt
          # إضافة ترددات SuperChannel للنطاق 5GHz
          for channel in 4920 4925 4930 4935 4940 4945 4950 4955 4960 4965 4970 4975 4980 4985 4990 4995 5000 5005 5010 5015 5020 5025 5030 5035 5040 5045 5050 5055 5060 5065 5070 5075 5080 5085 5090 5095 5100 5105 5110 5115 5120 5125 5130 5135 5140 5145 5150 5155 5160 5165 5170 5175 5180 5185 5190 5195 5200 5205 5210 5215 5220 5225 5230 5235 5240 5245 5250 5255 5260 5265 5270 5275 5280 5285 5290 5295 5300 5305 5310 5315 5320 5325 5330 5335 5340 5345 5350 5355 5360 5365 5370 5375 5380 5385 5390 5395 5400 5405 5410 5415 5420 5425 5430 5435 5440 5445 5450 5455 5460 5465 5470 5475 5480 5485 5490 5495 5500 5505 5510 5515 5520 5525 5530 5535 5540 5545 5550 5555 5560 5565 5570 5575 5580 5585 5590 5595 5600 5605 5610 5615 5620 5625 5630 5635 5640 5645 5650 5655 5660 5665 5670 5675 5680 5685 5690 5695 5700 5705 5710 5715 5720 5725 5730 5735 5740 5745 5750 5755 5760 5765 5770 5775 5780 5785 5790 5795 5800 5805 5810 5815 5820 5825 5830 5835 5840 5845 5850 5855 5860 5865 5870 5875 5880 5885 5890 5895 5900 5905 5910 5915 5920 5925 5930 5935 5940 5945 5950 5955 5960 5965 5970 5975 5980 5985 5990 5995 6000 6005 6010 6015 6020 6025 6030 6035 6040 6045 6050 6055 6060 6065 6070 6075 6080 6085 6090 6095 6100
          do
            echo "
            config wifi-device radio1
              option type \"mac80211\"
              option hwmode \"11a\"
              option country \"seinsoft\"
              option channel \"$channel\"
              option txpower \"30\"
              option htmode \"VHT80\"
              option noscan \"1\"" >> ./package/kernel/mac80211/files/etc/config/wireless
          done

      - name: Build OpenWRT Image
        run: |
          cd openwrt
          make -j$(nproc) V=s  # بناء الصورة مع التفاصيل

      - name: Save Artifacts
        uses: actions/upload-artifact@v4
        with:
          name: openwrt-image
          path: ./openwrt/bin/
